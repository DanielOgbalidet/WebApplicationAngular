{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"../orders.service\";\nconst _c0 = [\"startDate\"];\nconst _c1 = [\"endDate\"];\nexport class OrderformComponent {\n  constructor(_formbuilder, _router, _orderService, _route) {\n    this._formbuilder = _formbuilder;\n    this._router = _router;\n    this._orderService = _orderService;\n    this._route = _route;\n    this.orderId = -1;\n    this.pricePerNight = 0;\n    this.differenceInDays = 0;\n    this.dateInvalid = false;\n    this.orderForm = _formbuilder.group({\n      orderDate: [null],\n      userId: [null],\n      houseId: [null],\n      startDate: [null],\n      endDate: [null],\n      totalPrice: [null]\n    });\n  }\n  onSubmit() {\n    this.findDifferenceInDays();\n    const newPrice = this.pricePerNight * this.differenceInDays;\n    this.orderForm.patchValue({\n      totalPrice: newPrice\n    });\n    const newOrder = this.orderForm.value;\n    this._orderService.updateOrder(this.orderId, newOrder).subscribe(response => {\n      if (response.success) {\n        console.log(response.message);\n        this._router.navigate(['/Table']);\n      } else {\n        console.log('Order update failed');\n      }\n    });\n  }\n  ngOnInit() {\n    this._route.params.subscribe(params => {\n      this.orderId = +params['orderId'];\n      this.loadOrderForUpdate(this.orderId);\n    });\n  }\n  loadOrderForUpdate(orderId) {\n    this._orderService.getOrderById(orderId).subscribe(order => {\n      this.orderForm.patchValue({\n        orderDate: order.OrderDate,\n        userId: order.UserId,\n        houseId: order.HouseId,\n        startDate: order.StartDate,\n        endDate: order.EndDate,\n        totalPrice: order.TotalPrice\n      });\n      this.findPricePerNight();\n    }, error => {\n      console.error('Error loading order', error);\n    });\n  }\n  findPricePerNight() {\n    const total = this.orderForm.get(\"totalPrice\")?.value;\n    this.findDifferenceInDays();\n    this.pricePerNight = total / this.differenceInDays;\n  }\n  findDifferenceInDays() {\n    const startDateValue = this.orderForm.get('startDate')?.value;\n    const endDateValue = this.orderForm.get('endDate')?.value;\n    // Turn it into date objects so we can calculate the difference in days\n    const newstartDate = new Date(startDateValue);\n    const newendDate = new Date(endDateValue);\n    // Calculate the difference in milliseconds\n    const differenceInMs = newendDate.getTime() - newstartDate.getTime();\n    // Convert milliseconds to days\n    this.differenceInDays = Math.ceil(differenceInMs / (1000 * 60 * 60 * 24));\n  }\n  checkDates() {\n    this.findDifferenceInDays();\n    if (this.differenceInDays < 1) {\n      this.dateInvalid = true;\n    } else {\n      this.dateInvalid = false;\n    }\n  }\n}\nOrderformComponent.ɵfac = function OrderformComponent_Factory(t) {\n  return new (t || OrderformComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i3.OrderService), i0.ɵɵdirectiveInject(i2.ActivatedRoute));\n};\nOrderformComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: OrderformComponent,\n  selectors: [[\"app-orders-houseform\"]],\n  viewQuery: function OrderformComponent_Query(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵviewQuery(_c0, 5);\n      i0.ɵɵviewQuery(_c1, 5);\n    }\n    if (rf & 2) {\n      let _t;\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.startDate = _t.first);\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.endDate = _t.first);\n    }\n  },\n  decls: 15,\n  vars: 2,\n  consts: [[3, \"formGroup\", \"ngSubmit\"], [1, \"form-group\"], [\"for\", \"start\"], [1, \"bi\", \"bi-cash-coin\"], [\"type\", \"date\", \"id\", \"startDate\", \"formControlName\", \"startDate\", 1, \"form-control\", 3, \"change\"], [\"for\", \"end\"], [\"type\", \"date\", \"id\", \"endDate\", \"formControlName\", \"endDate\", 1, \"form-control\", 3, \"change\"], [\"id\", \"save\", \"type\", \"submit\", 1, \"btn\", \"btn-primary\", 3, \"disabled\"], [\"id\", \"cancel\", 1, \"btn\", \"btn-secondary\"]],\n  template: function OrderformComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"form\", 0);\n      i0.ɵɵlistener(\"ngSubmit\", function OrderformComponent_Template_form_ngSubmit_0_listener() {\n        return ctx.onSubmit();\n      });\n      i0.ɵɵelementStart(1, \"div\", 1)(2, \"label\", 2);\n      i0.ɵɵtext(3, \"Start_date \");\n      i0.ɵɵelement(4, \"i\", 3);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(5, \"input\", 4);\n      i0.ɵɵlistener(\"change\", function OrderformComponent_Template_input_change_5_listener() {\n        return ctx.checkDates();\n      });\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(6, \"div\", 1)(7, \"label\", 5);\n      i0.ɵɵtext(8, \"End-date \");\n      i0.ɵɵelement(9, \"i\", 3);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(10, \"input\", 6);\n      i0.ɵɵlistener(\"change\", function OrderformComponent_Template_input_change_10_listener() {\n        return ctx.checkDates();\n      });\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(11, \"button\", 7);\n      i0.ɵɵtext(12, \"Update order\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(13, \"button\", 8);\n      i0.ɵɵtext(14, \"Cancel\");\n      i0.ɵɵelementEnd()();\n    }\n    if (rf & 2) {\n      i0.ɵɵproperty(\"formGroup\", ctx.orderForm);\n      i0.ɵɵadvance(11);\n      i0.ɵɵproperty(\"disabled\", ctx.dateInvalid);\n    }\n  },\n  dependencies: [i1.ɵNgNoValidate, i1.DefaultValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, i1.FormGroupDirective, i1.FormControlName],\n  styles: [\"body[_ngcontent-%COMP%] {\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvT3JkZXIvb3JkZXJmb3JtL29yZGVyZm9ybS5jb21wb25lbnQuY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0EiLCJzb3VyY2VzQ29udGVudCI6WyJib2R5IHtcbn1cbiJdLCJzb3VyY2VSb290IjoiIn0= */\"]\n});","map":{"version":3,"mappings":"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","names":["OrderformComponent","constructor","_formbuilder","_router","_orderService","_route","orderForm","group","orderDate","userId","houseId","startDate","endDate","totalPrice","onSubmit","findDifferenceInDays","newPrice","pricePerNight","differenceInDays","patchValue","newOrder","value","updateOrder","orderId","subscribe","response","success","console","log","message","navigate","ngOnInit","params","loadOrderForUpdate","getOrderById","order","OrderDate","UserId","HouseId","StartDate","EndDate","TotalPrice","findPricePerNight","error","total","get","startDateValue","endDateValue","newstartDate","Date","newendDate","differenceInMs","getTime","Math","ceil","checkDates","dateInvalid","selectors","viewQuery","i0","ctx"],"sourceRoot":"","sources":["/Users/Leo/WebApplicationAngular/ClientApp/src/app/Order/orderform/orderform.component.ts","/Users/Leo/WebApplicationAngular/ClientApp/src/app/Order/orderform/orderform.component.html"],"sourcesContent":["import { Component, OnInit, ViewChild, ElementRef } from '@angular/core';\nimport { FormGroup, FormControl, Validators, FormBuilder, ReactiveFormsModule } from '@angular/forms';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { OrderService } from '../orders.service';\n\n@Component({\n  selector: \"app-orders-houseform\",\n  templateUrl: \"./orderform.component.html\",\n  styleUrls: ['./orderform.component.css']\n})\n\nexport class OrderformComponent {\n  @ViewChild('startDate') startDate!: ElementRef;\n  @ViewChild('endDate') endDate!: ElementRef;\n\n  orderForm: FormGroup;\n  orderId: number = -1;\n  pricePerNight: number = 0;\n  differenceInDays: number = 0;\n  dateInvalid: boolean = false;\n\n  constructor(private _formbuilder: FormBuilder,\n    private _router: Router,\n    private _orderService: OrderService,\n    private _route: ActivatedRoute) {\n    this.orderForm = _formbuilder.group({\n      orderDate: [null],\n      userId: [null],\n      houseId: [null],\n      startDate: [null],\n      endDate: [null],\n      totalPrice: [null]\n    });\n  }\n\n  onSubmit() {\n    this.findDifferenceInDays();\n\n    const newPrice = this.pricePerNight * this.differenceInDays;\n    this.orderForm.patchValue({\n      totalPrice: newPrice,\n    });\n\n    const newOrder = this.orderForm.value;\n\n    this._orderService.updateOrder(this.orderId, newOrder)\n      .subscribe(response => {\n        if (response.success) {\n          console.log(response.message);\n          this._router.navigate(['/Table']);\n        } else {\n          console.log('Order update failed');\n        }\n      });\n  }\n\n  ngOnInit(): void {\n    this._route.params.subscribe(params => {\n      this.orderId = +params['orderId'];\n      this.loadOrderForUpdate(this.orderId);\n    })\n  }\n\n\n  loadOrderForUpdate(orderId: number) {\n    this._orderService.getOrderById(orderId)\n      .subscribe(\n        (order: any) => {\n          this.orderForm.patchValue({\n            orderDate: order.OrderDate,\n            userId: order.UserId,\n            houseId: order.HouseId,\n            startDate: order.StartDate,\n            endDate: order.EndDate,\n            totalPrice: order.TotalPrice\n          });\n          this.findPricePerNight();\n        },\n        (error: any) => {\n          console.error('Error loading order', error);\n        }\n    )\n  }\n\n  findPricePerNight() {\n    const total = this.orderForm.get(\"totalPrice\")?.value;\n    this.findDifferenceInDays();\n\n    this.pricePerNight = total / this.differenceInDays;\n  }\n\n  findDifferenceInDays() {\n    const startDateValue = this.orderForm.get('startDate')?.value;\n    const endDateValue = this.orderForm.get('endDate')?.value;\n\n    // Turn it into date objects so we can calculate the difference in days\n    const newstartDate = new Date(startDateValue);\n    const newendDate = new Date(endDateValue);\n\n    // Calculate the difference in milliseconds\n    const differenceInMs = newendDate.getTime() - newstartDate.getTime();\n\n    // Convert milliseconds to days\n    this.differenceInDays = Math.ceil(differenceInMs / (1000 * 60 * 60 * 24));\n  }\n\n  checkDates() {\n    this.findDifferenceInDays();\n    if (this.differenceInDays < 1) {\n      this.dateInvalid = true;\n    } else {\n      this.dateInvalid = false;\n    }\n  }\n}\n","<form [formGroup]=\"orderForm\" (ngSubmit)=\"onSubmit()\">\n  <div class=\"form-group\">\n    <label for=\"start\">Start_date <i class=\"bi bi-cash-coin\"></i></label>\n    <input type=\"date\" id=\"startDate\" class=\"form-control\" formControlName=\"startDate\" (change)=\"checkDates()\"/>\n  </div>\n  <div class=\"form-group\">\n    <label for=\"end\">End-date <i class=\"bi bi-cash-coin\"></i></label>\n    <input type=\"date\" id=\"endDate\" class=\"form-control\" formControlName=\"endDate\" (change)=\"checkDates()\"/>\n  </div>\n  <button id=\"save\" class=\"btn btn-primary\" type=\"submit\" [disabled]=\"dateInvalid\">Update order</button>\n  <button id=\"cancel\" class=\"btn btn-secondary\">Cancel</button>\n</form>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}